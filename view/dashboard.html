<!DOCTYPE html>
<html lang="en">
{{template "header_start" .}}
<link href="./public/img/icon.png" rel="shortcut icon">
<title>dashboard</title>
<style type="text/css">
.btn-command {
    height: 50px;
    margin-left: 5px;
}

.command-ret {
    height: 400px;
    width: 100%;
    overflow: auto;
    padding-left: 150px;
}
</style>
{{template "header_end" .}}

<body class="sidebar-is-reduced">
    {{template "navbar" .}} {{$global:=.}}
    <main class="l-main">
        <div class="content-wrapper content-wrapper--with-bg">
            <div class="content-tab-active" data-toggle="tab" id="Cogs">
                <div class="alert alert-warning alert-dismissable">
                    <button type="button" class="close" data-dismiss="alert" aria-hidden="true">×</button>
                    <strong>Tips:</strong> 使用部分功能需要等待时间较长，请耐心等候，如果发现执行失败请截图通知程序。 同一个服务器每次只能执行一个操作，其余连接会因为其他人执行中导致无反应。 遇到这种情况请稍等片刻后再试。
                </div>
                {{range .servers}} {{$serverName:=.Name}}
                <div class="tab-menu-panel">
                    <a href="#">
                        <div class="flip">
                            {{$serverName}}
                        </div>
                    </a>
                    <div class="objpanel" role="tabpanel" class="tab-pane fade in active" id="seite1">
                        <article class="panel panel-default">
                            <header class="panel-heading">
                                <h1 class="text-muted text-center"><i class="fas fa-cloud fa-2x"></i></span>{{.Name}}</h1>
                            </header>
                            <div class="panel-body">
                                <div class="row">
                                    <div class="col-sm-1"></div>
                                    {{range .Commands}}
                                    <button class="col-sm-1 btn btn-primary btn-command" server="{{$serverName}}" command="{{.Tag}}" clientp="{{.Clientp}}">{{.Name}}</button>
                                    {{end}}
                                    <div class="col-sm-1"></div>
                                </div>
                                <hr style="border-top: 2px solid" />
                                <div class="row command-ret">
                                </div>
                            </div>
                            <footer class="panel-footer clearfi ">
                                <address class="pull-right">
                                    {{if .GamesrvAdmin}}
                                    <a class="btn btn-primary" onclick="jumpTo('{{.GamesrvAdmin}}')">游戏服务器后台</a>
                                    <a class="btn btn-primary" onclick="jumpTo('{{.ZonesrvAdmin}}')">zone服务器后台</a>
                                    {{end}}
                                </address>
                            </footer>
                        </article>
                    </div>
                </div>
                {{end}}
            </div>
            <div class="content-tab" data-toggle="tab" id="JumpList">
                <div class="panel panel-default">
                    {{range .jumplist}}
                    <div class="panel-heading">
                        <h1>{{.Name}}</h1>
                    </div>
                    <div class="panel-body">
                        {{range .Opts}}
                        <div>
                            <label>{{.Name}}:</label>
                            <a onclick="jumpTo('{{.Url}}')" style="cursor: pointer">{{.Url}}</a>
                        </div>
                        {{end}}
                    </div>
                    {{end}}
                </div>
            </div>
            <div class="content-tab" data-toggle="tab" id="UserList">
                <div class="panel" style="width:100%">
                    <div class="panel-heading">
                        <h3 class="panel-title">用户列表</h3>
                    </div>
                    <div class="panel-body">
                        <table class="table table-striped table-hover">
                            <thead class="thead-light">
                                <tr>
                                    {{range .userattrs}}
                                    <td class="authNames">{{.}}</td>
                                    {{end}}
                                </tr>
                            </thead>
                            <tbody>
                                {{range .userlist}}
                                <tr onclick="userclick(this)">
                                    <td>{{.uid}}</td>
                                    <td>{{.name}}</td>
                                    {{range .powers}}
                                    <td class="auth">{{.}}</td>
                                    {{end}}
                                </tr>
                                {{end}}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            {{range .logs}}
            <div class="content-tab" data-toggle="tab" id="Leitinglog-{{.}}" logid="{{.}}">
                <h1>当前日志服：{{.}}</h1>
                <div class="alert alert-warning alert-dismissable">
                    <button type="button" class="close" data-dismiss="alert" aria-hidden="true">×</button>
                    <strong>Tips:本日志通过aliyunlog获取，如果下载内容过多，会一直运行python进行文件内容下载，需要谨慎设置时长，如有问题及时联系开发者</strong>
                </div>
                <div class="panel logdownlist" style="width:100%">
                    <div class="panel-heading">
                        <h3 class="panel-title">uid日志列表</h3>
                        <p>每日每个uid仅写入单个文件，重复获取会导致覆盖</p>
                    </div>
                    <div class="row" style="margin-left:10px">
                        <label>Uid:</label><input class="loguid"></input>
                        <label>Aid(默认为0不检测):</label><input class="logaid" value="0"></input>
                        <label>开始时间:</label><input class="logstart" type="datetime-local"></input>
                        <label>结束时间:</label><input class="logend" type="datetime-local"></input>
                        <button class="btn btn-primary" onclick="leitinguidlog(this)">指定uid获取日志</button>
                    </div>
                    <div>
                        <a onclick="quickRefreshDownList(this)">刷新</a>
                    </div>
                    <div class="panel-body">
                        <table class="table table-striped table-hover">
                            <thead class="thead-light">
                                <tr>
                                    <td>文件名</td>
                                    <td>文件大小</td>
                                    <td>操作ip</td>
                                    <td>开始时间</td>
                                    <td>结束时间</td>
                                    <td>状态</td>
                                    <td>说明描述</td>
                                </tr>
                            </thead>
                            <tbody>
                            </tbody>
                        </table>
                    </div>
                </div>
                <div class="panel logerrlist" style="width:100%">
                    <div class="panel-heading">
                        <h3 class="panel-title">错误日志列表</h3>
                    </div>
                    <div>
                        <a onclick="quickRefreshErrList(this)"></a>
                    </div>
                    <div class="panel-body">
                        <table class="table table-striped table-hover">
                            <thead class="thead-light">
                                <tr>
                                    <td>文件名</td>
                                    <td>文件大小</td>
                                    <td>最后修改时间</td>
                                    <td>状态</td>
                                </tr>
                            </thead>
                            <tbody>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            {{end}}
            <div class="content-tab" data-toggle="tab" id="DBFlush">
                <div class="panel panel-default">
                    <h1>存档覆盖</h1>
                    <label>选择模板</label>
                    <select name="tmpl">
                        {{range .dbdata.tmpls}}
                        <option value="{{.Id}}">{{.Info}}</option>
                        {{end}}
                    </select>
                    <label>选择目标数据库</label>
                    <select name="db">
                        {{range .dbdata.crecs}}
                        <option value="{{.Id}}">{{.Info}}</option>
                        {{end}}
                    </select>
                    <label>覆盖的aid:</label>
                    <input name="aid"></input>
                    <label>覆盖的uid:</label>
                    <input name="uid"></input>
                    <button class="btn btn-primary" onclick="dbflush(this)">覆盖数据</button>
                </div>
                {{if .admin}}
                <div class="panel panel-default">
                    <h2>当前模板列表</h2>
                    <button type="button" class="btn btn-default" onclick="newtmpl()"><i class="fa fa-plus"></i>增加
                    </button>
                    <table class="table table-striped table-hover">
                        <thead class="thead-light">
                            <tr>
                                <td>id</td>
                                <td>模板信息</td>
                                <td>具体内容</td>
                                <td>权限</td>
                            </tr>
                        </thead>
                        <tbody>
                            {{range .dbdata.tmpls}}
                            <tr onclick="modifytmpl(this)">
                                <td>{{.Id}}</td>
                                <td>{{.Info}}</td>
                                <td detail="{{.Tmpl}}"><div style="overflow: auto;max-width:800px;max-height: 200px">{{.Tmpl}}</div></td>
                                <td>{{.Affect}}</td>
                                <td><button onclick="event.stopPropagation();deltmpl(this);" class="btn">删除</button></td>
                            </tr>
                            {{end}}
                        </tbody>
                    </table>
                    <h2>当前可作用数据库</h2>
                    <button type="button" class="btn btn-default" onclick="newcfg()"><i class="fa fa-plus"></i>增加
                    </button>
                    <table class="table table-striped table-hover">
                        <thead class="thead-light">
                            <tr>
                                <td>id</td>
                                <td>名称</td>
                                <td>具体配置</td>
                            </tr>
                        </thead>
                        <tbody>
                            {{range .dbdata.crecs}}
                            <tr onclick="modifycfg(this)">
                                <td>{{.Id}}</td>
                                <td>{{.Info}}</td>
                                <td>{{.Dest}}</td>
                                <td><button onclick="event.stopPropagation();delcfg(this);" class="btn">删除</button></td>
                            </tr>
                            {{end}}
                        </tbody>
                    </table>
                </div>
                {{end}}
            </div>
        </div>
    </main>
    <div class="checkbox-modal"></div>
    <!-- <div class="navbar navbar-default navbar-fixed-bottom">
    <div class="container">
        <p class="navbar-text pull-left">© 2017 - mateusmoural@hotmail.com </p>
    </div>
</div> -->
</body>

</html>